From a539d7bf72c030913cb11be11bfc1d00392d407d Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 24 Jul 2025 01:10:41 -0400
Subject: [PATCH 36/44] HACK: ntoskrnl: Add hidusb driver stub.

---
 dlls/ntoskrnl.exe/ntoskrnl.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/dlls/ntoskrnl.exe/ntoskrnl.c b/dlls/ntoskrnl.exe/ntoskrnl.c
index 0174aaf6ee5..54299071928 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.c
+++ b/dlls/ntoskrnl.exe/ntoskrnl.c
@@ -5003,7 +5003,7 @@ BOOL WINAPI VslGetSecurePciEnabled(void)
     return TRUE;
 }
 
-static NTSTATUS WINAPI pci_driver_stub( DRIVER_OBJECT *driver, UNICODE_STRING *path )
+static NTSTATUS WINAPI driver_stub( DRIVER_OBJECT *driver, UNICODE_STRING *path )
 {
     FIXME("%p %s stub!\n", driver, debugstr_us(path));
 
@@ -5018,6 +5018,7 @@ BOOL WINAPI DllMain( HINSTANCE inst, DWORD reason, LPVOID reserved )
     static void *handler;
     LARGE_INTEGER count;
     UNICODE_STRING str = RTL_CONSTANT_STRING( L"\\Driver\\pci" );
+    UNICODE_STRING hidusb = RTL_CONSTANT_STRING( L"\\Driver\\hidusb" );
 
     switch(reason)
     {
@@ -5031,7 +5032,8 @@ BOOL WINAPI DllMain( HINSTANCE inst, DWORD reason, LPVOID reserved )
         ntoskrnl_heap = HeapCreate( HEAP_CREATE_ENABLE_EXECUTE, 0, 0 );
         dpc_call_tls_index = TlsAlloc();
         LdrRegisterDllNotification( 0, ldr_notify_callback, NULL, &ldr_notify_cookie );
-        IoCreateDriver(&str, pci_driver_stub);
+        IoCreateDriver(&str, driver_stub);
+        IoCreateDriver(&hidusb, driver_stub);
         break;
     case DLL_PROCESS_DETACH:
         LdrUnregisterDllNotification( ldr_notify_cookie );
-- 
2.52.0

