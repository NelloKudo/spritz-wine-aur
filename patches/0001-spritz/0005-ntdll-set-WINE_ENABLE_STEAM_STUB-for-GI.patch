From 9141c1397002fbcd5ff2674c2dd37825abb998a8 Mon Sep 17 00:00:00 2001
From: NelloKudo <marshnelloosu@gmail.com>
Date: Thu, 18 Sep 2025 11:50:52 +0200
Subject: [PATCH 05/13] ntdll: set WINE_ENABLE_STEAM_STUB for GI

Based on Proton's hacks_init() function.
---
 dlls/ntdll/unix/loader.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/dlls/ntdll/unix/loader.c b/dlls/ntdll/unix/loader.c
index b805006f94d..1be9ab4eee1 100644
--- a/dlls/ntdll/unix/loader.c
+++ b/dlls/ntdll/unix/loader.c
@@ -1929,6 +1929,12 @@ static ULONG_PTR get_image_address(void)
     return 0;
 }
 
+static void hacks_init(void)
+{
+    if (main_argc > 1 && (strstr(main_argv[1], "GenshinImpact.exe") || strstr(main_argv[1], "YuanShen.exe") || strstr(main_argv[1], "fpsunlock.exe")))
+        setenv( "WINE_ENABLE_STEAM_STUB", "1", 0 );
+}
+
 /***********************************************************************
  *           start_main_thread
  */
@@ -1939,6 +1945,7 @@ static void start_main_thread(void)
     signal_init_threading();
     dbg_init();
     startup_info_size = server_init_process();
+    hacks_init();
     virtual_map_user_shared_data();
     init_cpu_info();
     init_files();
-- 
2.52.0

